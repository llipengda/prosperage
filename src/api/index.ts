import Taro from '@tarojs/taro'
import { ImageApi as _ImageApi, UserApi as _UserApi } from '@/api/autogenerated'
import { BASE_URL } from '@/common/constants'

const login = async () => {
  const code = (await Taro.login()).code
  return _UserApi.login({ code })
}
const UserApi = { ..._UserApi, login }

const uploadImage = async ({ path }: { path: string }) => {
  const res = await Taro.uploadFile({
    url: `${BASE_URL}/image`,
    filePath: path,
    name: 'file'
  })
  return JSON.parse(res.data).data as string
}
const ImageApi = { ..._ImageApi, uploadImage }

export * from '@/api/autogenerated'
export { UserApi, ImageApi }
